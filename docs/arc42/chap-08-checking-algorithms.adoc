[[template-method]]
=== Flexible Checking Algorithms
kbd:[HtmlSC] uses the {template-method-pattern} to enable flexible checking algorithms:

[quote, http://sourcemaking.com/design_patterns/template_method]
The Template Method defines a skeleton of an algorithm in an operation, and defers some steps to subclasses.

We achieve that by defining the skeleton of the checking algorithm in one operation, deferring the specific checking algorithm steps to subclasses.

The invariant steps are implemented in the abstract base class, while the variant checking algorithms have to be provided by the subclasses.

[source, groovy]
    /**
    ** template method for performing a single type of checks
     * on the given @see HtmlPage.
     *
     * Prerequisite: pageToCheck has been successfully parsed,
     * prior to constructing this Checker instance.
    **/
    public CheckingResultsCollector performCheck() {
        // assert prerequisite
        assert pageToCheck != null
        initResults()
        return check() // execute the actual checking algorithm
    }



image::template-method.png["Template Method", title="Template-Method Overview"]

[options="header", cols="1,4"]
.Template Method
|===
| Component | Description
| Checker                           | _abstract_ base class, containing the template method +check()+
                                        plus the public method +performCheck()+
| <<ImageFileExistChecker>>         | checks if referenced local image files exist
| <<BrokenCrossReferencesChecker>>  | checks if cross references (links referenced within the page) exist
| <<DuplicateIdChecker>>            | checks if any id has multiple definitions
| MissingAltTagsForImagesChecker    | (planned) checks if there are image tags without alt-attributes.
|===


==== ImageFileExistChecker

[small]#Adresses requirement <<Req1-MissingImageFiles>>.#

The (little) problem with checking images is their path: Consider the following
HTML fragment (from the file +testme.html+:


[source, html]
<img src="./images/one-image.jpg">


This image file ("one-image.jpg") has to be located relative to the directory containing the corresponding HTML file, i.e.:

   /Users/gstarke/projects/htmlSanityChecker/test/testme.html

Therefore the expected local absolute path of the "one-image.jpg" would be:

  /Users/gstarke/projects/htmlSanityChecker/test/images/one-image.jpg


We check for existing files using the usual Java api, but have to add the
+imagesDir+ (directory prefix) to the image-src given in the HTML tag to get the +absolutePathToImageFile+:


[source, java]
  File f = new File( absolutePathToImageFile );
  if(f.exists() && !f.isDirectory())



==== BrokenCrossReferencesChecker

[small]#Adresses requirement <<Req2-BrokenCrossReferences>>.#

Cross references are document-internal links where the +href="link-target" from the html anchor
tag has no prefix like +http+, +https+, +ftp+, +telnet+, +mailto+, +file+ and such.

Only links with prefix +#+ shall be taken into account, e.g. +<a href="#internalLink">+.
