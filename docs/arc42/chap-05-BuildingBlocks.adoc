
== Building Block View

=== Whitebox HtmlSanityChecker

image::hsc-whitebox.png["Whitebox", title="Whitebox (Overall system)"]

Rationale::

We used _functional decomposition_ to separate responsibilities:

* <<checker_blackbox, CheckerCore>> shall encapsulate checking logic and Html parsing/processing.
* all kinds of outputs (console, html-file, graphical) shall be handled in a separate component 
  (`Reporter`)
* Implementation of Gradle specific stuff shall be encapsulated.


Contained Blackboxes::

[cols="1,3" options=""]
.HtmlSanityChecker building blocks
|===
| <<checker_blackbox, CheckerCore>> | core: html parsing and sanity checking, file handling
| HSC Gradle Plugin | integrates the Gradle build tool with kbd:[HtmlSC],
enabling arbitrary gradle builds to use kbd:[HtmlSC] functionality.
| HSC Command Line Interface | (not documented)
| HSC Graphical Interface | (planned, not implemented)

| Reporter
| outputs the collected checking results to configurable
destinations, e.g. StdOut or a Html file.
|===


Interfaces::

[cols="1,4", options="header"]
.HtmlSanityChecker internal interfaces
|===
| Interface | Description
| usage via shell | <<arc42_user, arc42 user>> uses a command
line shell to call the kbd:[HtmlSC]
| build system  | currently restricted to Gradle: The build
system uses kbd:[HtmlSC] as configured in the buildscript.
| local-html and local-images | kbd:[HtmlSC] needs access to several
local files, especially the html page to be checked and to the
corresponding image directories.
|===


[[checker_blackbox]]
==== _CheckerCore_ (Blackbox)

Intent/Responsibility:: Checker contains the core functions
to perform the various sanity checks. It parses the html file
into a DOM-like in-memory representation, which is then
used to perform the actual checks.


Interfaces::

[cols="2,4", options="header"]
.CheckerCore Interfaces
|===
| Interface (From-To) | Description

| Command Line Interface -> Checker
| Exposes the #AllChecksRunner class, as described
in <<allChecksRunner, AllChecksRunner>>.

| Gradle Plugin -> Checker
| Exposes kbd:[HtmlSC] via a standard Gradle plugin,
as described in the Gradle user guide.
|===


Files::
    * +org.aim42.htmlsc.AllChecksRunner+
    * +org.aim42.htmlsc.HtmlSanityCheckGradlePlugin+


=== Building Blocks - Level 2

==== _CheckerCore_ (Whitebox)


image::CheckerCore-Whitebox.png["Whitebox", title="CheckerCore (Whitebox)"]

Rationale::
This structures follows a strictly functional decomposition:

* parsing and handling html input
* checking 
* collecting checking results

Contained Blackboxes::

[cols="1,4" options=""]
.CheckerCore building blocks
|===
| Checker
| abstract class, used in form of the template-pattern. Shall be subclassed
for all checking algorithms.

| AllChecksRunner
| Facade to the different Checker instances. Provides a (parameter-driven)
command-line interface.

| <<ResultsCollector>>
| Collects all checking results.

| HtmlParser
| Encapsulates html parsing, provides methods to search
within the (parsed) html.

|===


==== Checker and xyzChecker Subclasses

The abstract Checker provides a uniform interface (public void check())
to different checking algorithms. It is based upon the <<checking-concept,
concept of extensible checking algorithms>>.




=== Building Blocks - Level 3

==== ResultsCollector (Whitebox)


image::ResultsCollector.png["Whitebox", title="Results Collector (Whitebox)"]

Rationale::
This structures follows the hierarchy of checks:

Managing results for:

. a number of pages/documents
. a single page  
. a single check within a page



Contained Blackboxes::

[cols="1,4", options=""]
.Results-Collector building blocks
|===
| Per-Run-Results      | results for potentially many Html pages/documents.
| Single-Page-Results  | results for a single page
| Single-Check-Results | results for a single type of check (e.g. missing-images check)
| Finding              | a single finding, (e.g. "image 'logo.png' misssing")
|===
